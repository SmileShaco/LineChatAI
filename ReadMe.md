# LineChatAI - シンプルAI会話Bot

OpenAI ChatGPT-4o miniと統合したシンプルなLineBotです。メモリベースで会話履歴を保持し、文脈を理解した自然な会話ができます。

## 機能

- **自動会話履歴保持**: メモリ上で会話履歴を自動管理
- **文脈理解**: 過去の会話を踏まえたGPTとの対話
- **新しいチャット**: 会話履歴をリセットして新しい会話を開始
- **履歴クリア**: 簡単に会話履歴をリセット可能
- **シンプル設計**: ファイル管理不要で軽量動作

## システム構成

```
LineChatAI/
├── main.py              # メインアプリケーション
├── requirements.txt     # Python依存関係
├── Procfile            # Herokuデプロイ用
└── ReadMe.md           # このファイル
```

## セットアップ

### 1. 環境変数の設定

```bash
# LINE Bot設定
LINE_CHANNEL_ACCESS_TOKEN=your_line_channel_access_token_here
LINE_CHANNEL_SECRET=your_line_channel_secret_here

# OpenAI API設定
OPENAI_API_KEY=your_openai_api_key_here
```

### 2. 依存関係のインストール

```bash
pip install -r requirements.txt
```

### 3. アプリケーションの起動

```bash
python main.py
```

## 使用方法

### ユーザー操作

1. **QRコードでBotを友達追加**

2. **メニュー操作**
   - 📝 **新しいチャット**: 会話履歴をクリアして新しい会話を開始
   - 🗑️ **会話履歴をクリア**: 現在の会話履歴をリセット

3. **通常の会話**
   - 任意のメッセージを送信するだけで、GPTとの会話が開始
   - 過去の会話内容を記憶した文脈のある返答を受け取れます

### 特殊コマンド

- **メインメニュー**: メニューと現在の会話数を表示
- **デバッグ情報**: システム状態を確認

## システム動作

### 会話履歴管理

- **保存場所**: サーバーメモリ上（user_chat_histories辞書）
- **保持期間**: サーバー稼働中のみ（再起動でリセット）
- **自動制限**: 最新20回の会話のみ保持（古いものは自動削除）
- **形式**: OpenAI Chat Completions API形式

### GPT統合

- **モデル**: gpt-4o-mini
- **システムプロンプト**: 親切で知識豊富なAIアシスタント
- **文脈管理**: 会話履歴全体をAPIに送信
- **レスポンス制限**: 最大1000トークン

## 技術仕様

- **フレームワーク**: Flask
- **AI モデル**: OpenAI ChatGPT-4o-mini
- **メッセージング**: LINE Messaging API
- **データ管理**: メモリベース（永続化なし）
- **デプロイ**: Heroku対応

## メリット

✅ **シンプル**: ファイル管理やディレクトリ作成不要
✅ **高速**: メモリベースで高速レスポンス
✅ **軽量**: 最小限のリソース使用
✅ **保守性**: 複雑な機能がなく保守しやすい
✅ **スケーラブル**: メモリ使用量が自動制限される

## 注意事項

- サーバー再起動時に全ての会話履歴がリセットされます
- 長期間の会話履歴保持が必要な場合は別のソリューションを検討してください
- OpenAI APIの使用量制限に注意してください