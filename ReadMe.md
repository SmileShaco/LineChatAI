# LineChatAI - OpenAI統合LineBotシステム

OpenAI ChatGPT-4oと統合した高機能LineBotシステムです。チャット履歴の保存・管理機能とサマリー機能を備えています。

## 機能

- **新しいチャット開始**: 年月日時分秒のファイル名でチャット履歴を自動保存
- **過去のチャット履歴**: 過去の会話履歴の参照と継続
- **AI チャット**: OpenAI ChatGPT-4oとの対話
- **サマリー機能**: 長い会話を自動要約して文脈を保持
- **ユーザーフレンドリーUI**: Lineクイックリプライメニュー

## システム構成

```
LineChatAI/
├── main.py              # メインのLineBotアプリケーション
├── requirements.txt     # Python依存関係
├── chatlog/            # チャット履歴保存フォルダ
├── summarylog/         # チャット要約保存フォルダ
└── ReadMe.md           # このファイル
```

## セットアップ

### 1. 環境変数の設定

以下の環境変数を設定してください：

```bash
# LINE Bot設定
LINE_CHANNEL_ACCESS_TOKEN=your_line_channel_access_token_here
LINE_CHANNEL_SECRET=your_line_channel_secret_here

# OpenAI API設定
OPENAI_API_KEY=your_openai_api_key_here
```

### 2. 依存関係のインストール

```bash
pip install -r requirements.txt
```

### 3. ディレクトリの作成

```bash
mkdir chatlog summarylog
```

### 4. アプリケーションの起動

```bash
python main.py
```

## 使用方法

### ユーザー視点での操作フロー

1. **QRコードでBotを友達追加**

2. **初回利用時**: メインメニューが表示されます
   - 「新しいチャット」
   - 「過去の履歴」

3. **新しいチャット開始**
   - 「新しいチャット」を選択
   - 自動的に年月日時分秒のファイルが作成されます
   - ChatGPT-4oとの対話が開始できます

4. **過去の履歴参照**
   - 「過去の履歴」を選択
   - 利用可能なチャット履歴一覧が表示されます
   - 選択したチャットの履歴が表示され、続きから対話できます

5. **サマリー機能**
   - 「サマリー作成」と入力することで、現在のチャットを要約できます

## システム動作詳細

### チャット履歴管理

- **ファイル形式**: `YYYYMMDDHHMMSS.txt`
- **保存場所**: `chatlog/` ディレクトリ
- **記録形式**:
  ```
  [ユーザー]: ユーザーのメッセージ
  [gpt]: GPTの応答
  ```

### サマリー機能

- **保存場所**: `summarylog/` ディレクトリ
- **動作**: チャット履歴をGPT-4oが1000文字以内に要約
- **活用**: 新しいメッセージ送信時に過去の文脈として自動追加

### メニュー機能

- **実装方式**: LINE クイックリプライ
- **メインメニュー**: 新しいチャット / 過去の履歴
- **履歴選択**: 最大10件の履歴ファイルを表示

## 技術仕様

- **フレームワーク**: Flask
- **AI モデル**: OpenAI ChatGPT-4o
- **メッセージング**: LINE Messaging API
- **ファイル管理**: UTF-8テキストファイル
- **デプロイ**: Heroku対応（Procfile含む）

## エラーハンドリング

- OpenAI API接続エラー時の適切な応答
- ファイル読み書きエラーの処理
- 存在しないチャット履歴選択時の対応

## 運用上の注意点

- チャット履歴ファイルは定期的にバックアップを推奨
- OpenAI APIの使用量制限に注意
- LINE APIの月間メッセージ送信制限を考慮

## 今後の拡張可能性

- ユーザー認証機能
- チャット履歴の検索機能
- カスタムAIプロンプト設定
- 画像・音声メッセージ対応